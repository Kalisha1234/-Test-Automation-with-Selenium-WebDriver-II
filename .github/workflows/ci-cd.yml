name: XYZ Bank Test Automation CI/CD

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven
    
    - name: Build with Maven
      run: mvn clean compile
    
    - name: Run smoke tests first
      run: mvn test -Dtest=SmokeTest
      continue-on-error: false
    
    - name: Run browser tests
      run: mvn test -Dbrowser=chrome
      continue-on-error: true
    
    - name: Generate Allure Report
      if: always()
      run: mvn allure:report
    
    - name: Upload Allure Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: allure-results
        path: target/allure-results
    
    - name: Upload Allure Report
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: allure-report
        path: target/site/allure-maven-plugin

#  docker-build:
#    runs-on: ubuntu-latest
#    needs: test
#
#    steps:
#    - name: Checkout code
#      uses: actions/checkout@v3
#
#    - name: Build Docker image
#      run: docker build -t xyz-bank-automation:latest .
#
#    - name: Run tests in Docker
#      run: docker run --rm xyz-bank-automation:latest
